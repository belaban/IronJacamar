<deployment>

  <!-- Naming -->
  <bean name="LookupPool">
    <constructor factoryMethod="newFixedThreadPool"
                 factoryClass="java.util.concurrent.Executors">
      <parameter>2</parameter>
    </constructor>
  </bean>

  <bean name="NamingBeanImpl" class="org.jnp.server.NamingBeanImpl">
    <!-- Install this bean as the global JVM NamingServer -->
    <property name="installGlobalService">true</property>
    
    <property name="useGlobalService">false</property>
  </bean>

  <bean name="NamingServer" class="org.jnp.server.Main">
    <property name="namingInfo"><inject bean="NamingBeanImpl"/></property>

    <!-- The call by value mode. true if all lookups are unmarshalled using
         the caller's TCL, false if in VM lookups return the value by reference.
      -->
    <property name="callByValue">false</property>
    
    <!-- The listening port for the bootstrap JNP service. Set this to -1
         to run the NamingService without the JNP invoker listening port.
      -->
    <property name="port">1099</property>
    
    <!-- The bootstrap JNP server bind address. This also sets the default
         RMI service bind address. Empty == all addresses
      -->
    <property name="bindAddress">${jboss.jca.bindaddress:localhost}</property>

    <!-- The port of the RMI naming service, 0 == anonymous -->
    <property name="rmiPort">0</property>

    <!-- The RMI service bind address. Empty == all addresses -->
    <property name="rmiBindAddress">${jboss.jca.bindaddress:localhost}</property>

    <!-- Set the java.rmi.server.hostname system property to rmiBindAddress -->
    <property name="enableRmiServerHostname">true</property>

    <!-- The thread pool service used to control the bootstrap lookups -->
    <property name="lookupExector"><inject bean="LookupPool"/></property>
  </bean>
  
  <!-- JMX -->
  <bean name="JMX" class="org.jboss.jca.sjc.hack.JMX"/>

  <!-- Transaction manager -->
  <bean name="TransactionManager" class="com.arjuna.ats.jbossatx.jta.TransactionManagerService">
    <property name="transactionTimeout">300</property>
    <property name="objectStoreDir">${jboss.jca.home}/tmp/tx-object-store</property>
    <property name="mbeanServer"><inject bean="JMX" property="mbeanServer"/></property>
    <property name="transactionStatusManagerInetAddress">localhost</property>
    <property name="transactionStatusManagerPort">4713</property>
    <property name="recoveryInetAddress">localhost</property>
    <property name="recoveryPort">4712</property>
    <property name="socketProcessIdPort">0</property>    
  </bean>

  <!-- Work Manager thread pool -->
  <bean name="WorkManagerThreadPool" interface="org.jboss.jca.common.threadpool.ThreadPool" class="org.jboss.jca.common.threadpool.ThreadPoolImpl">
    <!-- The name that appears in thread names -->
    <property name="name">WorkManager</property>

    <!-- The maximum amount of work in the queue -->
    <property name="maximumQueueSize">1024</property>
    
    <!-- The maximum number of active threads -->
    <property name="maximumPoolSize">100</property>
    
    <!-- How long to keep threads alive after their last work (default one minute) -->
    <property name="keepAliveTime">60000</property>
  </bean>

  <!-- Work Manager -->
  <bean name="WorkManager" interface="org.jboss.jca.core.api.WorkManager" class="org.jboss.jca.core.workmanager.WorkManagerImpl">
    <!-- The thread pool -->
    <property name="threadPool"><inject bean="WorkManagerThreadPool"/></property>

    <!-- The XA terminator -->
    <property name="XATerminator"><inject bean="TransactionManager" property="XATerminator"/></property>
  </bean>
  
  <!-- Connection Manager -->
  <bean name="ConnectionManager" interface="org.jboss.jca.core.api.ConnectionManager" class="org.jboss.jca.core.connectionmanager.ConnectionManagerImpl">
  </bean>


  <!-- Deployers -->

  <!-- RA deployer -->
  <bean name="RADeployer" interface="org.jboss.jca.sjc.deployers.Deployer" class="org.jboss.jca.sjc.deployers.ra.RADeployer">
  </bean>

</deployment>
