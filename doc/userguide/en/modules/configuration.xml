<?xml version="1.0" encoding="UTF-8"?>
<chapter id="configuration">
   <title>Configuration</title>

   <para>The configuration for the JBoss JCA container is located in the config/ directory.</para>

   <section id="logging">
      <title>Logging service</title>

      <para>The JBoss JCA container uses JBoss Logging framework as the implementation.</para>

      <para>The configuration is done in the</para>

      <programlisting>
config/logging.properties
      </programlisting>

      <para>file.</para>

      <para>Consult the <ulink url="http://www.jboss.org/community/wiki/JBossBootLogging">
          JBoss Logging documentation</ulink> on how the service can be configured.</para>

   </section>

   <section id="transaction">
      <title>Transaction service</title>

      <para>The JBoss JCA container uses the JBoss Transaction Manager as its transaction implementation.</para>

      <para>The configuration is done in the</para>

      <programlisting>
config/transaction.xml
      </programlisting>

      <para>file.</para>

      <para>Consult the JBoss Transaction documentation on how the service can be configured.</para>

   </section>

   <section id="jca">
      <title>JCA</title>

      <section id="jca_deployer">
        <title>Deployer</title>

        <para>The JBoss JCA deployer is configured in the</para>

        <programlisting>
config/bootstrap/jca.xml
        </programlisting>

        <para>file, as the</para>

        <programlisting>
&lt;bean name="RADeployer" 
      interface="com.github.fungal.spi.deployers.Deployer" 
      class="org.jboss.jca.deployers.fungal.RADeployer"&gt;
  &lt;depends&gt;BeanValidation&lt;/depends&gt;
  &lt;depends&gt;WorkManager&lt;/depends&gt;
&lt;/bean&gt;
        </programlisting>

        <para>bean.</para>

        <table frame="all">
          <title>JCA Deployer</title>
          <tgroup cols="3" align="left" colsep="1" rowsep="1">
            <colspec colname="c1" colwidth="2*"/>
            <colspec colname="c2"/>
            <colspec colname="c3" colwidth="3*"/>
            <thead>
              <row>
                <entry align="left">Property</entry>
                <entry align="left">Type</entry>
                <entry align="left">Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><code>ArchiveValidation</code></entry>
                <entry><code>boolean</code></entry>
                <entry>
                  Toggle archive validation for the deployment units.
                  <para>Default: <code>true</code></para>
                </entry>
              </row>
              <row>
                <entry><code>ArchiveValidationFailOnWarn</code></entry>
                <entry><code>boolean</code></entry>
                <entry>
                  Should an archive validation warning report fail the deployment.
                  <para>Default: <code>false</code></para>
                </entry>
              </row>
              <row>
                <entry><code>ArchiveValidationFailOnError</code></entry>
                <entry><code>boolean</code></entry>
                <entry>
                  Should an archive validation error report fail the deployment.
                  <para>Default: <code>true</code></para>
                </entry>
              </row>
              <row>
                <entry><code>BeanValidation</code></entry>
                <entry><code>boolean</code></entry>
                <entry>
                  Toggle bean validation (JSR-303) for the deployment units.
                  <para>Default: <code>true</code></para>
                </entry>
              </row>
              <row>
                <entry><code>DefaultBootstrapContext</code></entry>
                <entry><code>org.jboss.jca.core.api.CloneableBootstrapContext</code></entry>
                <entry>
                  Specifies the default bootstrap context for resource adapters
                </entry>
              </row>
              <row>
                <entry><code>BootstrapContexts</code></entry>
                <entry><code>Map&lt;String, org.jboss.jca.core.api.CloneableBootstrapContext&gt;</code></entry>
                <entry>
                  Bootstrap context map (unique name to a cloneable bootstrap context) which allows
                  developers to bind (through <code>jboss-ra.xml</code>) their resource adapter to
                  a specific bootstrap context instance.
                </entry>
              </row>
              <row>
                <entry><code>PrintStream</code></entry>
                <entry><code>java.io.PrintStream</code></entry>
                <entry>
                  Specifies which print stream that should be used to handle the <code>LogWriter</code>s
                </entry>
              </row>
              <row>
                <entry><code>ScopeDeployment</code></entry>
                <entry><code>boolean</code></entry>
                <entry>
                  Should each deployment be scoped (isolated) from the container. This feature allows
                  deployment of libraries of a different version than used in the container environment.
                  <para>Default: <code>false</code></para>
                </entry>
              </row>
              <row>
                <entry><code>JndiStrategy</code></entry>
                <entry><code>org.jboss.jca.core.spi.naming.JndiStrategy</code></entry>
                <entry>
                  Specifies the JNDI strategy policy for binding the connection factories into
                  the naming environment
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="jca_security">
        <title>Security</title>

        <para>The Java EE Connector Architecture 1.6 specification allows units of 
          <code>javax.resource.spi.Work</code> to be executed in a specific security context.</para>

        <para>This is done through the use of Java Authentication Service Provider Interface for Containers (JSR-196)
          call backs using the <code>javax.security.auth.callback.Callback</code> interface.</para>
        
        <para>The support is activated by letting the work instance implement the</para>

        <programlisting>
javax.resource.spi.work.WorkContextProvider
        </programlisting>

        <para>interface and returning an instance of <code>javax.resource.spi.work.SecurityContext</code>.</para>

        <para>There is currently support for injecting a user/roles setup based on the files</para>

        <programlisting>
config/users.properties
config/roles.properties
        </programlisting>

        <para>The format of the <code>users.properties</code> file is</para>

        <programlisting>
username1=password1
username2=password2
        </programlisting>

        <para>The format of the <code>roles.properties</code> file is</para>

        <programlisting>
username1=role1,role2
username2=role3,role4
        </programlisting>
        
        <para>The user/roles setup can be configured through the <code>UsersRoles</code> bean in the 
          <code>config/bootstrap/jca.xml</code> file.</para>
        
        <programlisting>
          <![CDATA[
<!-- Users / roles -->
<bean name="UsersRoles"
      interface="org.jboss.jca.core.spi.security.Callback"
      class="org.jboss.jca.core.security.UsersRoles">
  <property name="UsersProperties">${jboss.jca.home}/config/users.properties</property>
  <property name="RolesProperties">${jboss.jca.home}/config/roles.properties</property>
</bean>
           ]]>
        </programlisting>

      </section>

   </section>

   <section id="webserver">
      <title>Web server</title>

      <para>The JBoss JCA project features a web server which is used to serve web archive deployments.</para>

      <para>The configuration is done in the</para>

      <programlisting>
system/web.xml
      </programlisting>

      <para>file.</para>

      <table frame="all">
        <title>Web server</title>
        <tgroup cols="3" align="left" colsep="1" rowsep="1">
          <colspec colname="c1" colwidth="2*"/>
          <colspec colname="c2"/>
          <colspec colname="c3" colwidth="3*"/>
          <thead>
            <row>
              <entry align="left">Property</entry>
              <entry align="left">Type</entry>
              <entry align="left">Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><code>Port</code></entry>
              <entry><code>int</code></entry>
              <entry>
                Set the port for the web server
                <para>Default: <code>8080</code></para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>The web server can be removed from the environment by removing the <code>web.xml</code>
        file in</para>

      <programlisting>
system/
      </programlisting>

      <para>Furthermore all .WAR files in the same directory should be removed too.</para>

      <para>All the Jetty libraries can be removed by deleting the</para>

      <programlisting>
lib/jetty
      </programlisting>

      <para>directory.</para>

   </section>


</chapter>
