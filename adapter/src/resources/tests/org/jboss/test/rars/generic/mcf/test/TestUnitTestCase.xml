<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns="urn:jboss:bean-deployer:2.0">

   <bean name="AspectManager" class="org.jboss.aop.AspectManager">
      <constructor factoryClass="org.jboss.aop.AspectManager" factoryMethod="instance"/>
   </bean>
   
   <beanfactory name="TraceAdvice" class="org.jboss.rars.advice.TraceAdvice"/>
   
   <bean name="TraceAspect" class="org.jboss.aop.microcontainer.beans.Aspect">
      <property name="advice"><inject bean="TraceAdvice"/></property>
      <property name="manager"><inject bean="AspectManager"/></property>
   </bean>
   
   <bean name="ManagedConnectionFactory" class="org.jboss.test.rars.generic.mcf.support.TestManagedConnectionFactory">
   </bean>
   
   <beanfactory name="ConnectionFactoryAdvice" class="org.jboss.rars.generic.cf.ConnectionFactoryAdvice"/>
   
   <bean name="ConnectionFactoryAspect" class="org.jboss.aop.microcontainer.beans.Aspect">
      <property name="advice"><inject bean="ConnectionFactoryAdvice"/></property>
      <property name="manager"><inject bean="AspectManager"/></property>
   </bean>
   
   <bean name="ConnectionFactoryBinding" class="org.jboss.aop.microcontainer.beans.StackBinding">
      <property name="pointcut">execution(* $instanceof{org.jboss.rars.generic.mcf.direct.DirectConnectionFactory}->*(..))</property>
      <property name="manager"><inject bean="AspectManager"/></property>
      <property name="advices">
         <list>
            <inject bean="TraceAspect" property="definition"/>
            <inject bean="ConnectionFactoryAspect" property="definition"/>
         </list>
      </property>
   </bean>
   
   <beanfactory name="WrapperAdvice" class="org.jboss.rars.generic.wrapper.WrapperAdvice"/>
   
   <bean name="WrapperAspect" class="org.jboss.aop.microcontainer.beans.Aspect">
      <property name="advice"><inject bean="WrapperAdvice"/></property>
      <property name="manager"><inject bean="AspectManager"/></property>
   </bean>
   
   <beanfactory name="ClosedAdvice" class="org.jboss.rars.generic.wrapper.ClosedAdvice"/>
   
   <bean name="ClosedAspect" class="org.jboss.aop.microcontainer.beans.Aspect">
      <property name="advice"><inject bean="ClosedAdvice"/></property>
      <property name="manager"><inject bean="AspectManager"/></property>
   </bean>
   
   <bean name="ConnectionBinding" class="org.jboss.aop.microcontainer.beans.StackBinding">
      <property name="pointcut">execution(* $instanceof{org.jboss.rars.generic.wrapper.GenericHandle}->*(..))</property>
      <property name="manager"><inject bean="AspectManager"/></property>
      <property name="advices">
         <list>
            <inject bean="TraceAspect" property="definition"/>
            <inject bean="ClosedAspect" property="definition"/>
            <inject bean="WrapperAspect" property="definition"/>
         </list>
      </property>
   </bean>
   
   <bean name="ConnectionFactory" class="java.lang.Object">
      <constructor factoryMethod="createConnectionFactory">
         <factory bean="ManagedConnectionFactory"/>
      </constructor>
   </bean>
      
</deployment>
